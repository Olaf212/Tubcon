<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TUBCON</title>

    <!-- CSS Principal -->
    <link rel="stylesheet" href="src/index.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="public/images/iconoa.ico">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- CSS del Chatbot (externo) -->
    <link rel="stylesheet" href="src/chatbot.css">


</head>

<body>
    <!-- PRELOADER EXTERNO -->
    <div id="preloader-container">
        <iframe src="preloader.html" frameborder="0" style="width:100%; height:100%;"></iframe>
    </div>
    
    <!-- HEADER -->
    <header>
        <div class="logo">
            <a href="index.html">
                <img src="public/images/logo.png" class="logo" alt="TUBCON S.A. de C.V." />
            </a>
        </div>

        <nav class="menu-desktop">
            <ul>
                <li><a href="index.html" style="color:#EF0315">Inicio</a></li>
                <li><a href="#quienes-somos">¿Quiénes somos?</a></li>
                <li><a href="products.html">Productos</a></li>
                <li><a href="ubication.html">Instalaciones</a></li>
                <li><a href="email.html">Asesoría</a></li>
                <li><a href="brands.html">Distribuidores</a></li>
                <li><a href="contact.html">Contacto</a></li>
            </ul>
        </nav>
        <button class="hamburger" id="hamburger">&#9776;</button>
        <nav id="sidebar">
            <button class="close" id="close">&times;</button>
            <div class="sidebar-logo">
                <img src="public/images/logo.png" alt="TUBCON S.A. de C.V.">
            </div>
            <br><br>
            <ul>
                <li><a href="index.html" style="color:#EF0315">Inicio</a></li>
                <li><a href="#quienes-somos">¿Quiénes somos?</a></li>
                <li><a href="products.html">Productos</a></li>
                <li><a href="ubication.html">Instalaciones</a></li>
                <li><a href="email.html">Asesoría</a></li>
                <li><a href="brands.html">Distribuidores</a></li>
                <li><a href="contact.html">Contacto</a></li>
            </ul>
            <div class="sidebar-bottom">
                <a href="https://www.google.com/maps?q=TUBCON%20SA%20DE%20CV" target="_blank">
                    <i class="fa-solid fa-location-dot"></i> Dónde comprar
                </a>
                <a href="#">Sé un distribuidor TUBCON</a>
                <a href="https://wa.me/5543225189" target="_blank">
                    <i class="fa-solid fa-phone"></i> 55-43-22-51-89
                </a>
            </div>
        </nav>
    </header>

    <!-- HERO -->
    <section id="inicio" class="hero">
        <div class="carousel">
            <div class="slides">
                <img src="public/images/fondo.png" alt="Imagen 1">
                <img src="public/images/fondo2.jpg" alt="Imagen 2">
                <img src="public/images/fondo3.jpg" alt="Imagen 3">
            </div>
        </div>
        <div class="hero-text">
            <h1>Expertos en plomería</h1>
            <p>Tubos, conexiones y accesorios de PVC</p>
        </div>
    </section>

    <!-- QUIÉNES SOMOS -->
    <section id="quienes-somos">
        <h2>¿Quiénes somos?</h2>
        <p>Tubcon es una empresa enfocada principalmente a la distribución de mayoreo de material de plomería en general
            trabajando principalmente con las mejores marcas del mercado, comprando la mayoría de sus productos directo
            de fábrica, satisfaciendo así al público en general, mayoristas y constructores con los mejores precios del
            mercado.</p>
    </section>

    <!-- MISIÓN VISIÓN -->
    <section id="mision-vision">
        <div class="grid">
            <div class="item">
                <h2>Misión</h2>
                <h3>Comercializar productos con marcadas especificaciones técnicas para uso industrial que combinados
                    con el desarrollo de ingeniería, tecnología y servicio postventa satisfacen necesidades de nuestros
                    clientes, asegurando el crecimiento de la empresa, los utilidades de los accionistas y la calidad de
                    vida de los miembros de la organización.</h3>
            </div>
            <div class="item">
                <h2>Visión</h2>
                <h3>Consolidar nuestra EMPRESA en la industria y el comercio, contando con un talento humano competente
                    que promueve el desarrollo y crecimiento de la organización organizando la excelente relación con
                    nuestros clientes y proveedores.</h3>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <p>© 2025 TUBCON S.A. de C.V. </p>
    
    </footer>

    <div id="overlay"></div>

    <!-- CHATBOT DESKTOP -->
    <div class="chatbot-container" id="desktopChatbot">
        <div class="chatbot-header" id="chatbotToggle">
            <span>Asistente TUBCON</span>
            <i class="fas fa-robot"></i>
        </div>
        <div class="chatbot-body" id="chatbotBody">
            <div class="chatbot-messages" id="chatbotMessages"></div>
            <div class="chatbot-input">
                <input type="text" id="userInput" placeholder="Escribe tu pregunta...">
                <button id="sendButton"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- CHATBOT MÓVIL -->
    <div class="chatbot-bubble" id="mobileChatbotBubble">
        <i class="fas fa-comment"></i>
    </div>

    <div class="chatbot-mobile-window" id="mobileChatbotWindow">
        <div class="chatbot-header">
            <span>Asistente TUBCON</span>
            <button class="close-chat" id="closeMobileChat">×</button>
        </div>
        <div class="chatbot-messages" id="mobileChatbotMessages"></div>
        <div class="chatbot-input">
            <input type="text" id="mobileUserInput" placeholder="Escribe tu pregunta...">
            <button id="mobileSendButton"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- WHATSAPP FLOAT -->
    <div class="whatsapp-float" id="whatsappFloat">
        <a href="https://wa.me/525543225189" id="whatsappLink" target="_blank">
            <i class="fab fa-whatsapp"></i>
        </a>
        <div class="whatsapp-tooltip">
            ¿Necesitas ayuda?
        </div>
    </div>

    <!-- SCRIPTS -->
    <!-- Menú móvil -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const hamburger = document.getElementById('hamburger');
            const sidebar = document.getElementById('sidebar');
            const closeBtn = document.getElementById('close');
            const overlay = document.getElementById('overlay');
            hamburger.addEventListener('click', function () {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                document.body.classList.add('menu-active');
                document.body.style.overflow = 'hidden';
            });
            closeBtn.addEventListener('click', closeMenu);
            overlay.addEventListener('click', closeMenu);
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') closeMenu();
            });
            function closeMenu() {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                document.body.classList.remove('menu-active');
                document.body.style.overflow = '';
            }
        });
    </script>

    <!-- Chatbot -->
    <script type="module">
        import { knowledgeBase, procesarMensaje } from './chatbot.js';
        let isDesktopChatOpen = false;
        let isMobileChatOpen = false;

        document.addEventListener('DOMContentLoaded', function () {
            const saludoAleatorio = knowledgeBase.saludos[
                Math.floor(Math.random() * knowledgeBase.saludos.length)
            ];
            const mensajeDivDesktop = document.createElement('div');
            mensajeDivDesktop.className = 'message bot-message';
            mensajeDivDesktop.textContent = saludoAleatorio;
            document.getElementById('chatbotMessages').appendChild(mensajeDivDesktop);
            const mensajeDivMobile = document.createElement('div');
            mensajeDivMobile.className = 'message bot-message';
            mensajeDivMobile.textContent = saludoAleatorio;
            document.getElementById('mobileChatbotMessages').appendChild(mensajeDivMobile);
            document.getElementById('chatbotToggle').addEventListener('click', toggleDesktopChat);
            document.getElementById('sendButton').addEventListener('click', function () {
                sendMessage('userInput', 'chatbotMessages');
            });
            document.getElementById('userInput').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') sendMessage('userInput', 'chatbotMessages');
            });
            document.getElementById('mobileSendButton').addEventListener('click', function () {
                sendMessage('mobileUserInput', 'mobileChatbotMessages');
            });
            document.getElementById('mobileUserInput').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') sendMessage('mobileUserInput', 'mobileChatbotMessages');
            });
            const whatsappLink = document.getElementById('whatsappLink');
            const isMobile = window.innerWidth <= 768;
            whatsappLink.href = isMobile
                ? "https://wa.me/525543225189"
                : "https://web.whatsapp.com/send?phone=525543225189";
        });

        function toggleDesktopChat() {
            const chatBody = document.getElementById('chatbotBody');
            isDesktopChatOpen = !isDesktopChatOpen;
            if (isDesktopChatOpen) {
                chatBody.classList.add('active');
                if (window.innerWidth > 768) {
                    document.getElementById('whatsappFloat').classList.add('hidden');
                }
                setTimeout(() => {
                    const messages = document.getElementById('chatbotMessages');
                    messages.scrollTop = messages.scrollHeight;
                }, 300);
            } else {
                chatBody.classList.remove('active');
                if (window.innerWidth > 768) {
                    document.getElementById('whatsappFloat').classList.remove('hidden');
                }
            }
        }

        async function sendMessage(inputId, messagesId) {
            const userInput = document.getElementById(inputId);
            const messageText = userInput.value.trim();
            if (!messageText) return;
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'message user-message';
            userMessageDiv.textContent = messageText;
            document.getElementById(messagesId).appendChild(userMessageDiv);
            userInput.value = '';
            userInput.focus();
            const messages = document.getElementById(messagesId);
            messages.scrollTop = messages.scrollHeight;
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message typing-indicator';
            typingDiv.innerHTML = '<span></span><span></span><span></span>';
            messages.appendChild(typingDiv);
            messages.scrollTop = messages.scrollHeight;
            try {
                const respuesta = await procesarMensaje(messageText);
                const typingIndicator = messages.querySelector('.typing-indicator');
                if (typingIndicator) typingIndicator.remove();
                appendBotMessage(respuesta, messagesId);
            } catch (error) {
                console.error("Error procesando mensaje:", error);
                const typingIndicator = messages.querySelector('.typing-indicator');
                if (typingIndicator) typingIndicator.remove();
                appendBotMessage("No pude procesar tu solicitud en este momento. ¿Podrías intentarlo de nuevo?", messagesId);
            }
        }

        function appendBotMessage(message, messagesId) {
            const botMessageDiv = document.createElement('div');
            botMessageDiv.className = 'message bot-message';
            botMessageDiv.innerHTML = message;
            document.getElementById(messagesId).appendChild(botMessageDiv);
            const messages = document.getElementById(messagesId);
            messages.scrollTop = messages.scrollHeight;
        }

        const mobileBubble = document.getElementById('mobileChatbotBubble');
        const mobileWindow = document.getElementById('mobileChatbotWindow');
        const closeMobile = document.getElementById('closeMobileChat');
        if (mobileBubble && mobileWindow && closeMobile) {
            mobileBubble.addEventListener('click', function () {
                isMobileChatOpen = true;
                mobileWindow.classList.add('active');
                document.body.classList.add('chatbot-active');
                document.body.style.overflow = 'hidden';
                mobileBubble.classList.add('hidden');
            });
            closeMobile.addEventListener('click', function () {
                isMobileChatOpen = false;
                mobileWindow.classList.remove('active');
                document.body.classList.remove('chatbot-active');
                document.body.style.overflow = '';
                mobileBubble.classList.remove('hidden');
            });
            let startY = 0;
            mobileWindow.addEventListener('touchstart', function (e) {
                startY = e.touches[0].clientY;
            });
            mobileWindow.addEventListener('touchmove', function (e) {
                const currentY = e.touches[0].clientY;
                if (currentY - startY > 100) {
                    isMobileChatOpen = false;
                    mobileWindow.classList.remove('active');
                    document.body.classList.remove('chatbot-active');
                    document.body.style.overflow = '';
                    mobileBubble.classList.remove('hidden');
                }
            });
        }

        window.addEventListener('resize', function () {
            const whatsappLink = document.getElementById('whatsappLink');
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
                whatsappLink.href = "https://wa.me/525543225189";
                document.getElementById('whatsappFloat').classList.remove('hidden');
                if (isMobileChatOpen) {
                    document.getElementById('mobileChatbotBubble').classList.add('hidden');
                } else {
                    document.getElementById('mobileChatbotBubble').classList.remove('hidden');
                }
            } else {
                whatsappLink.href = "https://web.whatsapp.com/send?phone=525543225189";
                if (isDesktopChatOpen) {
                    document.getElementById('whatsappFloat').classList.add('hidden');
                } else {
                    document.getElementById('whatsappFloat').classList.remove('hidden');
                }
                document.getElementById('mobileChatbotBubble').classList.add('hidden');
            }
        });
    </script>






    <!-- Script para ocultar preloader -->
    <script>
        window.addEventListener('load', function() {
            setTimeout(function() {
                const preloader = document.getElementById('preloader-container');
                preloader.classList.add('fade-out');
                
                setTimeout(function() {
                    preloader.style.display = 'none';
                }, 500);
            }, 1000);
        });
    </script>
</body>
</body>

</html>